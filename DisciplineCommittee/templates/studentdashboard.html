{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Student Portal- Dashboard</title>
  
  <link rel="stylesheet" href="{% static 'DisciplineCommittee/style.css' %}">
  <link rel="stylesheet" href="{% static 'DisciplineCommittee/studentdashboard.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="dashboard-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <i class="fas fa-graduation-cap"></i>
       <h2 style="color: white;">Student Portal</h2>

      </div>
      <nav class="sidebar-nav">
        <a href="#dashboard" class="nav-item active" data-section="dashboard"><i class="fas fa-home"></i><span>Dashboard</span></a>
        <a href="#profile" class="nav-item" data-section="profile"><i class="fas fa-user"></i><span>My Profile</span></a>
        <a href="#complaints" class="nav-item" data-section="complaints"><i class="fas fa-exclamation-triangle"></i><span>My Complaints</span></a>
        <a href="#statistics" class="nav-item" data-section="statistics"><i class="fas fa-chart-bar"></i><span>Statistics</span></a>
      </nav>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <h1 id="pageTitle">Dashboard</h1>
          <p class="welcome-text">Welcome back, <span id="studentName">Student User</span>!</p>
        </div>
        <div class="header-right">
          <div class="search-box"><i class="fas fa-search"></i><input id="searchInput" placeholder="Search complaints..."></div>
          <div class="notification-bell"><i class="fas fa-bell"></i><span class="badge" style="display:none">0</span></div>
          <button id="themeToggle" class="mobile-menu-btn" title="Toggle menu"><i class="fas fa-bars"></i></button>
        </div>
      </header>

      <!-- Dashboard Section -->
      <section id="dashboard" class="content-section active">
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-icon blue"><i class="fas fa-file-alt"></i></div><div class="stat-info"><h3 id="totalComplaints">{{ total_complaints }}</h3><p>Total Complaints</p></div></div>
        </div>
        <div class="recent-activity">
          <div style="display:flex;gap:24px;align-items:flex-start;">
            <div style="flex:1">
              <h2>Recent Complaints</h2>
              <div id="recentComplaintsList" class="complaints-list">
                {% if recent_complaints %}
                  {% for complaint in recent_complaints %}
                    <div class="complaint-card" style="padding:10px">
                      <div style="font-weight:700">{{ complaint.title }}</div>
                      <div style="font-size:13px;color:var(--muted, #64748b)">{{ complaint.date }} â€¢ {{ complaint.status }}</div>
                    </div>
                  {% endfor %}
                {% else %}
                  <p style="color:var(--muted, #64748b)">No recent complaints</p>
                {% endif %}
              </div>
            </div>
            <div style="width:320px;">
              <h2>Recent Activity</h2>
              <div id="recentActivityList" style="min-height:80px;padding:12px;border-radius:8px;background:var(--bg-color);border:1px solid rgba(0,0,0,0.04)"></div>
              <h3>Your Discipline Cases</h3>

<table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Date</th>
      <th>Description</th>
    </tr>
  </thead>

  <tbody>
    {% for case in cases %}
    <tr>
      <td>{{ case.case_type }}</td>
      <td>{{ case.date }}</td>
      <td>{{ case.description }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="3">No cases reported</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

            </div>
          </div>
        </div>
      </section>

      <!-- Profile Section -->
      <section id="profile" class="content-section">
        <div class="profile-container">
          <div class="profile-header">
            <div class="profile-avatar" style="position:relative">
              <img id="profileImage" src="https://via.placeholder.com/150" alt="Profile">
              <button id="editAvatarBtn" class="edit-avatar-btn" title="Change profile picture"><i class="fas fa-camera"></i></button>
              <input id="avatarInput" type="file" accept="image/*" class="hidden" aria-hidden="true">
            </div>
            <h2>Edit Profile</h2>
            <p>Update your personal information</p>
          </div>

          <form id="profileForm" class="profile-form">
            <div class="form-group">
              <label for="fullName"><i class="fas fa-user"></i> Full Name</label>
              <input id="fullName" name="fullName" type="text" placeholder="Full Name" required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="studentId"><i class="fas fa-id-card"></i> UUCMS ID</label>
                <input id="studentId" name="studentId" type="text" placeholder="STU...">
              </div>
              <div class="form-group">
                <label for="email"><i class="fas fa-envelope"></i> Email</label>
                <input id="email" name="email" type="email" placeholder="you@university.edu">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="phone"><i class="fas fa-phone"></i> Phone Number</label>
                <input id="phone" name="phone" type="tel" placeholder="1234567890">
              </div>
              <div class="form-group">
                <label for="course"><i class="fas fa-book"></i> Course</label>
                <input id="course" name="course" type="text" placeholder="Course">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="class"><i class="fas fa-users"></i> Class</label>
                <input id="class" name="class" type="text" placeholder="Class">
              </div>
              <div class="form-group">
                <label for="year"><i class="fas fa-calendar"></i> Year</label>
                <input id="year" name="year" type="text" placeholder="Year">
              </div>
            </div>

            <div class="form-actions">
              <button class="btn btn-primary" type="submit"><i class="fas fa-save"></i> Save Changes</button>
              <button class="btn btn-secondary" id="resetFormBtn" type="button"><i class="fas fa-undo"></i> Reset</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Complaints Section -->
      <section id="complaints" class="content-section">
        <div class="complaints-header" style="display:flex;justify-content:space-between;align-items:center;">
          <h2>My Complaints</h2>
          <div style="display:flex;gap:12px;align-items:center">
            <div style="display:flex;gap:8px;align-items:center">
              <select id="filterStatus" class="filter-select"><option value="all">All Status</option><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="resolved">Resolved</option><option value="rejected">Rejected</option></select>
              <select id="filterPriority" class="filter-select"><option value="all">All Priorities</option><option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option><option value="urgent">Urgent</option></select>
            </div>
            <button id="exportBtn" class="btn btn-secondary"><i class="fas fa-download"></i> Export</button>
          </div>
        </div>

        <div id="complaintsList" class="complaints-list" style="margin-top:12px"></div>
        <div id="noComplaints" class="empty-state" style="display:none;margin-top:18px"><i class="fas fa-inbox" style="font-size:48px;color:#cbd5e1"></i><h3>No Complaints Received</h3><p>You have no complaints from teachers at this time.</p></div>
      </section>

      <!-- Statistics -->
      <section id="statistics" class="content-section">
        <h2>Complaint Statistics</h2>
        <div class="stats-charts">
          <div class="chart-card"><h3>Complaints by Status</h3><div class="chart-container"><canvas id="statusChart"></canvas></div></div>
          <div class="chart-card"><h3>Complaints by Priority</h3><div class="chart-container"><canvas id="priorityChart"></canvas></div></div>
        </div>
        <div class="timeline-card"><h3>Complaint Timeline</h3><div id="timelineList" class="timeline"></div></div>
      </section>

      <!-- Complaint modal -->
      <div id="complaintModal" class="modal hidden">
        <div id="modalOverlay" class="modal-overlay"></div>
        <div class="modal-box">
          <button id="modalClose" class="modal-close"><i class="fas fa-times"></i></button>
          <h3 id="modalTitle"></h3>
          <p id="modalDesc"></p>
          <p class="muted" id="modalMeta"></p>
          <div style="display:flex;gap:10px;margin-top:12px">
            <button id="modalResolveBtn" class="btn btn-primary">Mark Resolved</button>
            <button id="modalDeleteBtn" class="btn btn-secondary">Delete</button>
          </div>
        </div>
      </div>

    </main>
  </div>

  <div id="toast" class="toast">Saved</div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  {% if profile %}
  {{ profile|json_script:"profile-data" }}
  <script>
    try{
      const p = JSON.parse(document.getElementById('profile-data').textContent);
      localStorage.setItem('studentProfile_v1', JSON.stringify(p));
    }catch(e){ /* ignore */ }
  </script>
  {% endif %}
  {% if cases_json %}
  {{ cases_json|json_script:"student-cases" }}
  <script>
    try{
      const cs = JSON.parse(document.getElementById('student-cases').textContent || '[]');
      const complaints = cs.map((c, i) => ({
        id: i + 1,
        title: c.case_type,
        date: c.date,
        category: c.case_type,
        description: c.description,
        status: 'pending',
        priority: 'medium',
        response: null
      }));
      localStorage.setItem('studentComplaints', JSON.stringify(complaints));
    }catch(e){ /* ignore */ }
  </script>
  {% endif %}
  <script src="{% static 'DisciplineCommittee/script.js' %}"></script>
  <script src="{% static 'DisciplineCommittee/studentdashboard.js' %}"></script>
</body>
</html>
